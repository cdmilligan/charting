<script>
function notePage(info, tab) {
  if (!info.selectionText || info.selectionText.length == 0) {
    return;
  }
  var maxLength = 1024;
  var searchText = (info.selectionText.length <= maxLength) ?
                   info.selectionText : info.selectionText.substr(0, maxLength);
  var url = "http://tagnote.mhnltd.co.uk?quote=" + escape(searchText) + "&url=" + escape(tab.url) + "&title=" + tab.title;
  chrome.tabs.create({"url": url});
}

chrome.experimental.contextMenu.create({"title": "Note this site with '%s'", "onclick": notePage,
                                        "contexts":["SELECTION"]});
</script>
