<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
       "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <title>Charting: <%= controller_name %></title>
  <%= stylesheet_link_tag 'scaffold' %>
  <%= javascript_include_tag :defaults %>
</head>
<body>

<div id="goalmenu">
<h2><%=link_to "Charting", root_path%></h2>
<% if @current_user %>
  <h3>My Goals</h3>
  <ul>
    <% if ['notes', 'users', 'sources'].include? controller_name
      link_path = controller_name
      else
      link_path = "notes"
      end %>

    <% for goal in @all_goals %>
      <% if goal == @current_goal %>
        <li class="active-goal"> 
      <% else %>
        <li>
      <%end%>
        <%=link_to goal.name, goal_path(goal) + "/" + link_path%> 
        <%= link_to '[-]', goal, :confirm => "Remove #{goal.name}?", :method => :delete %></td>
      </li>
    <% end %>
    
    <li>
    <% form_for Goal.new, :html => {:id => "new_goal_form"} do |f| %>
      <%= f.text_field :name, 
                       :size => 10, 
                       :id => 'new_goal_field', 
                       :value => 'new goal', 
                       :onFocus => 'if (this.value == "new goal") {this.value = "";};',
                       :onBlur => 'if (this.value == "") {this.value = "new goal";};' %>
    <% end %>
    </li>

   
    <% if action_name == "inbox" %>
      <li class="active-goal">
    <% else %>
      <li>
    <% end %>
      <%=link_to "Inbox", inbox_path%>
    </li>

    <% if action_name == "all_goals" %>
      <li class="active-goal">
    <% else %>
      <li>
    <% end %>
      <%=link_to "All goals", all_goals_path%>
    </li>
    
    <% unless @current_goal or action_name == "inbox" or action_name == "all_goals" %>
      <li class="active-goal">
    <% else %>
      <li>
    <% end %>
      <%=link_to "All my goals", "/" + link_path%>
    </li>
 
  <% else %>
    <h3>Please log in.</h3>
  </ul>
<% end %>
</div>

<div id="right">
  <%= render :partial => 'layouts/login' %>
  <div id="tabmenu">
    <div id="tabs">
      <% unless @notabs %>
        <%  ["notes", "users", "sources"].each do |tab|
          tab_disp = ""
          if tab == "users"
            tab_disp = "people"
          else
            tab_disp = tab
          end
          
          if tab == controller_name
            if @current_goal
              -%><span class="active tab"><%=link_to(tab_disp, goal_path(@current_goal) + "/" + tab)-%></span><% 
            else 
              -%><span class="active tab"><%=link_to tab_disp, "/" + tab -%></span><% 
            end
          else 
            if @current_goal
              -%><span class="tab"><%=link_to(tab_disp, goal_path(@current_goal) + "/" + tab)-%></span><%
            else
              -%><span class="tab"><%=link_to tab_disp, "/" + tab -%></span><%
            end
          end
        end 
      end%>
    </div>
    <%= render :partial => 'layouts/search' %>
  </div>

  <div id="content">
    <p style="color: green"><%= notice %></p>
    <p style="color: red"><%= flash[:error] %></p>

    <%= yield %>
  </div>
</div>

</body>
</html>
